# Credits to github/nickavem for the script, Doomsdayrs for edits

app-id: com.atlauncher.ATLauncher
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk

sdk-extensions:
    - org.freedesktop.Sdk.Extension.openjdk8
    - org.freedesktop.Sdk.Compat.i386
    - org.freedesktop.Sdk.Extension.toolchain-i386

command: atlauncher.sh

build-options:
    prepend-path: /app/jre/bin

finish-args:
    - --env=PATH=/app/jre/bin:/usr/bin:/app/bin
    - --socket=x11
    - --share=ipc
    - --device=all
    - --socket=pulseaudio
    - --share=network

add-extensions:
  x-compat-i386-opts: &compat_i386_opts
    prepend-pkg-config-path: /app/lib32/pkgconfig:/usr/lib/i386-linux-gnu/pkgconfig
    ldflags: -L/app/lib32
    append-path: /usr/lib/sdk/toolchain-i386/bin
    env:
      CC: i686-unknown-linux-gnu-gcc
      CXX: i686-unknown-linux-gnu-g++
    libdir: /app/lib32

modules:
    - name: openjdk
      buildsystem: simple
      build-commands:
          - /usr/lib/sdk/openjdk8/install.sh

    - name: gamemode
      buildsystem: meson
      config-opts: &gamemode_opts
          - -Dwith-systemd=false
          - -Dwith-daemon=false
          - -Dwith-examples=false
          - -Dwith-util=false
          - -Dwith-sd-bus-provider=no-daemon
      sources: &gamemode_sources
          - type: archive
            url: https://github.com/FeralInteractive/gamemode/releases/download/1.6.1/gamemode-1.6.1.tar.xz
            sha256: 10c2a3f142eae472f5a09e42616e38c666c05b25ca3e61e562a543bb3fda66c5

    - name: gamemode-32bit
      build-options:
        arch:
          x86_64: *compat_i386_opts
      buildsystem: meson
      config-opts: *gamemode_opts
      sources: *gamemode_sources

    - name: gamemoderun
      buildsystem: simple
      build-commands:
        - install -Dm755 data/gamemoderun -t /app/bin
      sources: *gamemode_sources

    - name: atlauncher
      buildsystem: simple
      build-commands:
          - install -D ATLauncher.jar /app/bin/ATLauncher.jar
      sources:
          - type: file
            dest-filename: ATLauncher.jar
            url: https://github.com/ATLauncher/ATLauncher/releases/download/v3.4.13.0/ATLauncher-3.4.13.0.jar
            tag: v3.4.13.0
            sha256: 3ca33bc79b489a5443e91681814ee233b2c75fb240fbcc56c21f8b197324a266
            x-checker-data:
             type: git
             url: https://github.com/ATLauncher/ATLauncher.git
             tag-pattern: ^([\d.]+)$
        

    - name: atlauncher.sh
      buildsystem: simple
      build-commands:
          - install -D atlauncher.sh /app/bin/atlauncher.sh
      sources:
          - type: file
            path: atlauncher.sh

    - name: atlauncher-extra
      buildsystem: simple
      build-commands:
          - install -D com.atlauncher.ATLauncher.desktop /app/share/applications/com.atlauncher.ATLauncher.desktop
          - install -D com.atlauncher.ATLauncher.metainfo.xml /app/share/metainfo/com.atlauncher.ATLauncher.appdata.xml
          - install -D icon.svg /app/share/icons/hicolor/scalable/apps/com.atlauncher.ATLauncher.svg
      sources:
          - type: file
            path: com.atlauncher.ATLauncher.metainfo.xml
          - type: file
            path: com.atlauncher.ATLauncher.desktop
          - type: file
            path: images/icon.svg
